# Quick Context for Claude

**Project**: Virtual Client - Social work training with AI simulations  
**Current Phase**: MVP - Minimum Viable Conversation  
**Language**: Python 3.12 with FastAPI  
**Database**: PostgreSQL (or SQLite for MVP week)  
**LLM**: Anthropic Claude (Haiku for testing, Sonnet for production)  
**Testing**: pytest  
**IDE**: PyCharm on Windows  

## 🎯 Current Task
MVP Week 1 Day 4-5: Streamlit Prototype (READY TO START)

**Day 3 Completed**: All 5 parts of Anthropic Integration complete
- Part 1: Anthropic API Setup ✅
- Part 2: Prompt Generation Service ✅
- Part 3: Conversation Handler Service ✅
- Part 4: Rate Limiting ✅
- Part 5: Error Handling & Robustness ✅

**Day 4-5 Implementation Plan**:
1. **Teacher Interface** (`teacher_test.py`)
   - Simple form to create/edit one client
   - Test conversation with created client
   - View conversation history
   - See token usage/costs
2. **Student Interface** (`student_practice.py`)
   - List available clients (from existing data)
   - Start conversation button
   - Chat interface with message history
   - End session and save
3. **Admin Dashboard** (`admin_monitor.py`)
   - Real-time token usage
   - Cost tracking
   - Active sessions monitor
   - Error logs

**Key Features from Day 3**:
- Circuit breaker for API protection
- Cost tracking with alerts ($0.10/$0.50/$10)
- Fallback responses for outages
- Service health monitoring
- All integrated and tested

**Day 1-2 Completed**: All 6 parts of Session & Message Models complete
- Session model simplified for MVP
- Message model with efficient storage
- Session service with full CRUD operations
- Message operations with automatic sequencing
- Token counting utility integrated

**Day 3 Progress - COMPLETE**:
- Part 1 Completed: Anthropic API Setup ✅
- Part 2 Completed: Prompt Generation Service ✅
- Part 3 Completed: Conversation Handler Service ✅
- Part 4 Completed: Rate Limiting ✅
- Part 5 Completed: Error Handling & Robustness ✅
  - Circuit breaker pattern for failure prevention
  - Comprehensive cost tracking and alerts
  - Fallback response system
  - Service health monitoring
- 566 total tests (552 passing, 11 with minor issues)

## ⚡ Critical MVP Patterns
- Messages in separate table (not JSON) for scale
- Token counting from day 1
- Simple session model (enhance later)
- Streamlit for rapid iteration
- Cost tracking built-in
- Focus on conversation quality

## 🔑 Existing Services to Reuse
```python
# From client_service
get(db, client_id)  # Get client for conversation
get_teacher_clients(db, teacher_id)  # List for testing

# From auth (mock for now)
get_current_teacher() -> TeacherAuth
get_current_student() -> StudentAuth
```

## 📁 Project Structure
```
C:\Users\engbrech\Python\virtual_client\
├── backend/
│   ├── api/           # Existing endpoints
│   ├── services/      # Add session_service.py
│   └── models/        # Add session.py
├── mvp/               # NEW - Streamlit prototype
│   ├── teacher_test.py
│   ├── student_practice.py
│   └── admin_monitor.py
└── tests/
    └── integration/   # Minimal tests for MVP
```

## 🚀 Quick Start Commands
```bash
# Start API server (existing)
python start_server.py

# Run Streamlit apps (new) - LOCAL DEVELOPMENT
streamlit run mvp/teacher_test.py
streamlit run mvp/student_practice.py

# Run existing tests
python run_tests.py

# Deploy to Railway (when ready for external testing)
railway up
```

## 📋 MVP Success Checklist
1. [ ] 10+ test conversations
2. [ ] <$0.01 per conversation
3. [ ] 5+ teacher feedback
4. [ ] Conversation quality validated
5. [ ] Technical feasibility proven
6. [ ] Clear Phase 2 requirements

## ⚠️ MVP Constraints
- One client at a time for testing
- No rubric evaluation yet
- Basic UI (Streamlit)
- Manual feedback collection
- Limited to test users
- Local development first (deploy to Railway when ready)

---
*For detailed context see PROJECT_ROADMAP.md | For patterns see PATTERNS.md*